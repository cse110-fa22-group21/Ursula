<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: add.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: add.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>// Imports
import { openEditForm } from "./edit.js";

// Global Variables
/**
 * @type {Array}
 */
var data = [];
// TODO: consider another array to store deleted tasks
// var deleted = [];

// Run the init() function when the page has loaded
window.addEventListener("DOMContentLoaded", init);

// Starts the task program, all function calls trace back here
function init() {
  let tasks = getTasksFromStorage();
  // Add each task to the &lt;tbody> element
  addTaskToDocument(tasks);
  // Add the event listeners to the form elements
  initFormHandler();
}

// -------------------------- ADD TASK POPUP --------------------------------------

// Add functions to add button on-click
document.getElementById("addButton").addEventListener("click", openForm);
document.getElementById("cancelButton").addEventListener("click", closeForm);

/*
 * Add button function
 * Once the user clicks on the add button, the popup form should pop up
 */
function openForm() {
  document.getElementById("popupForm").style.display = "block";
}

/*
 * Cancel button function
 * Once the user clicks on the button, the popup form should be closed
 */
function closeForm() {
  document.getElementById("popupForm").style.display = "none";
}

// -------------------------- ADD DATA STORAGE --------------------------------------
/**
 * Generates a unique ID using crypto.randomUUID.
 * https://stackoverflow.com/questions/1155008/how-unique-is-uuid
 * @returns {string} A unique string ID to represent each task.
 */
function generateUniqueID() {
  return crypto.randomUUID();
}

/**
 * Takes in an array of tasks and for each task creates a
 * new &lt;to-do-task> element, adds the task data to that item
 * using element.data = {...}, and then appends that new task
 * to &lt;tbody>
 * @param {Array&lt;Object>} tasks An array of recipes
 */
function addTaskToDocument(tasks) {
  for (let i = 0; i &lt; tasks.length; i++) {
    addTask(tasks[i]);
  }
}

/**
 * Populate the table using the data object.
 *
 * @param {Object} data - The data to pass into the &lt;task>, must be of the
 *                        following format:
 *                        {
 *                          "id": "number",
 *                          "name": "string",
 *                          "hours": "number",
 *                          "minutes": "number",
 *                          "type": "string",
 *                          "status": "string",
 *                          "notes": "string"
 *                        }
 */
function addTask(data) {
  // populate data in the table
  const tableRow = document.createElement("tr");

  // The information from data is added following the below format
  tableRow.innerHTML = `&lt;td>${data.name}&lt;/td>
  &lt;td>${data.hours} hr ${data.minutes} min&lt;/td>
  &lt;td>${data.status}&lt;/td>
  &lt;td>&lt;button class="editButton" id="editButton${data.id}">
  &lt;img id="editIcon" src="admin/branding/edit-icon.svg" alt="Edit icon button for task ${data.id}">&lt;/button>&lt;/td>`;

  document.body.querySelector("tbody").append(tableRow);
  document.getElementById(`editButton${data.id}`).onclick = openEditForm;
}

/**
 * Reads 'tasks' from localStorage and returns an array of
 * all of the tasks found. If nothing is found in localStorage for
 * 'tasks', an empty array is returned.
 * @returns {Array&lt;Object>} An array of recipes found in localStorage
 */
function getTasksFromStorage() {
  return JSON.parse(localStorage.getItem("tasks")) || [];
}

/**
 * Takes in an array of tasks, converts it to a string, and then
 * saves that string to 'tasks' in localStorage
 * @param {Array&lt;Object>} tasks An array of recipes
 */
function saveTaskToStorage(tasks) {
  localStorage.setItem("tasks", JSON.stringify(tasks));
}

/** STORE DATA FROM TASK POPUP
 * Initializes the handler function when the task form is submitted.
 *
 * Task data is populated from each input in the form, generated with a unique ID, and
 * assigned the initial status. The new task is then added into local storage.
 */
function initFormHandler() {
  // Get data from task popup form
  const form = document.querySelector("form");

  form.addEventListener("submit", () => {
    let formData = new FormData(form);
    let taskData = new Object();
    for (const key of formData.keys()) {
      taskData[key] = formData.get(key);
    }

    taskData.status = "Planned";
    taskData.id = generateUniqueID();

    //populate the table
    addTask(taskData);

    // save data to global variable
    data.push(taskData);

    let tasks = getTasksFromStorage();
    tasks.push(taskData);
    saveTaskToStorage(tasks);
  });
}

export { getTasksFromStorage, saveTaskToStorage };
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#addTask">addTask</a></li><li><a href="global.html#addTaskToDocument">addTaskToDocument</a></li><li><a href="global.html#data">data</a></li><li><a href="global.html#generateUniqueID">generateUniqueID</a></li><li><a href="global.html#getTasksFromStorage">getTasksFromStorage</a></li><li><a href="global.html#initFormHandler">initFormHandler</a></li><li><a href="global.html#saveTaskToStorage">saveTaskToStorage</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.0</a> on Fri Nov 18 2022 20:12:37 GMT-0800 (Pacific Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
